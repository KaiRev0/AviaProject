{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏{% endblock %}

{% block content %}
<div class="dashboard admin-dashboard">
    <div class="admin-header-with-actions">
        <div>
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h2>
            <p>–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: {{ staff|length }}</p>
        </div>
        <div class="header-actions">
            <a href="/admin/staff/add" class="btn create-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
            <a href="/admin" class="btn back-btn">‚Üê –ù–∞–∑–∞–¥</a>
        </div>
    </div>
    
    <!-- –ü–û–ò–°–ö –°–û–¢–†–£–î–ù–ò–ö–û–í -->
    <div class="search-section">
        <h3>üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
        <form method="POST" class="search-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="text" id="phone" name="phone" 
                           placeholder="+7 999 123-45-67">
                </div>
                <div class="form-group">
                    <label for="role">–†–æ–ª—å:</label>
                    <select id="role" name="role">
                        <option value="">–í—Å–µ</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="cashier">–ö–∞—Å—Å–∏—Ä</option>
                    </select>
                </div>
            </div>
            <div class="form-buttons">
                <button type="submit" class="btn search-btn">–ù–∞–π—Ç–∏</button>
                <button type="reset" class="btn reset-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <a href="/admin/staff" class="btn show-all-btn">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö</a>
            </div>
        </form>
    </div>
    
    <!-- –°–ü–ò–°–û–ö –°–û–¢–†–£–î–ù–ò–ö–û–í -->
    <div class="staff-table-section">
        <h3>üìã –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
        
        {% if staff %}
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–†–æ–ª—å</th>
                        <th>–ü–∞—Å–ø–æ—Ä—Ç</th>
                        <th>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for person in staff %}
                    <tr>
                        <td>{{ person.id }}</td>
                        <td>
                            <strong>{{ person.phone }}</strong>
                        </td>
                        <td>
                            <span class="role-badge role-{{ person.role }}">
                                {% if person.role == 'admin' %}üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                {% elif person.role == 'cashier' %}üíº –ö–∞—Å—Å–∏—Ä
                                {% else %}{{ person.role }}{% endif %}
                            </span>
                        </td>
                        <td>{{ person.passport_series }} {{ person.passport_number }}</td>
                        <td>{{ person.organization_number or '-' }}</td>
                        <td>{{ person.created_at[:16] if person.created_at else '-' }}</td>
                        <td>
                            {% if person.last_login %}
                            {{ person.last_login[:16] }}
                            {% else %}
                            –ù–∏–∫–æ–≥–¥–∞
                            {% endif %}
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <a href="/admin/staff/edit/{{ person.id }}" 
                                   class="btn-action edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    ‚úèÔ∏è
                                </a>
                                {% if person.id != session.user_id %}
                                <a href="/admin/staff/delete/{{ person.id }}" 
                                   class="btn-action delete" 
                                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ {{ person.phone }}?')"
                                   title="–£–¥–∞–ª–∏—Ç—å">
                                    üóëÔ∏è
                                </a>
                                {% endif %}
                                {% if person.role == 'cashier' %}
                                <a href="/admin/flights?created_by={{ person.id }}" 
                                   class="btn-action flights" title="–†–µ–π—Å—ã –∫–∞—Å—Å–∏—Ä–∞">
                                    ‚úàÔ∏è
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="no-data">
            {% if search_performed %}
            <p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            {% else %}
            <p>–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
    <div class="stats-section">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats-cards">
            {% set admins = staff|selectattr('role', 'equalto', 'admin')|list %}
            {% set cashiers = staff|selectattr('role', 'equalto', 'cashier')|list %}
            {% set active_users = staff|rejectattr('last_login', 'none')|list %}
            
            <div class="stat-card">
                <div class="stat-value">{{ admins|length }}</div>
                <div class="stat-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ cashiers|length }}</div>
                <div class="stat-label">–ö–∞—Å—Å–∏—Ä–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ active_users|length }}</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ (staff|length - active_users|length) }}</div>
                <div class="stat-label">–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—Ö–æ–¥–∏–ª–∏</div>
            </div>
        </div>
    </div>
</div>

<style>
/* –†–æ–ª–∏ */
.role-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.role-admin {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    color: #ef6c00;
}

.role-cashier {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    color: #2e7d32;
}

/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.btn-action.flights {
    background: #bbdefb;
    color: #0d47a1;
}

.btn-action.flights:hover {
    background: #90caf9;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1000px) {
    .table-container {
        overflow-x: auto;
    }
    
    .admin-table {
        font-size: 14px;
    }
}
</style>
{% endblock %}