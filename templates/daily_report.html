{% extends "base.html" %}

{% block title %}–î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="header-with-back">
        <h2>–î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç –ø–æ –≤—ã—Ä—É—á–∫–µ</h2>
        <a href="/cashier" class="back-btn">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã -->
    <div class="report-form">
        <form method="POST">
            <div class="form-group">
                <label for="date">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
                <input type="date" id="date" name="date" 
                       value="{{ report_date }}" 
                       max="{{ today if today else '2026-01-01' }}">
                <button type="submit" class="btn generate-btn">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç</button>
            </div>
        </form>
    </div>
    
    <!-- –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
     <div class="summary-cards">
    <div class="summary-card sales">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
            <div class="card-value">{{ report['total_sales']|int }} ‚ÇΩ</div>
            <div class="card-label">–û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</div>
            <div class="card-subtext">{{ report['sales_count'] }} –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        </div>
    </div>
    
    <div class="summary-card commission">
        <div class="card-icon">üíµ</div>
        <div class="card-content">
            <div class="card-value">{{ report['commission']|int }} ‚ÇΩ</div>
            <div class="card-label">–í–∞—à–∞ –∫–æ–º–∏—Å—Å–∏—è (10%)</div>
            <div class="card-subtext">–û—Ç –ø—Ä–æ–¥–∞–∂</div>
        </div>
    </div>
    
    <div class="summary-card returns">
        <div class="card-icon">‚Ü©Ô∏è</div>
        <div class="card-content">
            <div class="card-value">{{ report['total_returns']|int }} ‚ÇΩ</div>
            <div class="card-label">–°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</div>
            <div class="card-subtext">{{ report['returns_count'] }} –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        </div>
    </div>
    
    <div class="summary-card total">
        <div class="card-icon">üìä</div>
        <div class="card-content">
            {% set net_commission = report['commission'] - report['commission_loss'] %}
            <div class="card-value {{ 'positive' if net_commission >= 0 else 'negative' }}">
                {{ net_commission|int }} ‚ÇΩ
            </div>
            <div class="card-label">–ß–∏—Å—Ç–∞—è –∫–æ–º–∏—Å—Å–∏—è</div>
            <div class="card-subtext">–î–æ—Ö–æ–¥ –∑–∞ –¥–µ–Ω—å</div>
        </div>
    </div>
</div>

{% if flights_stats and flights_stats['flights_created'] > 0 %}
<div class="flights-stats-card">
    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–º —Ä–µ–π—Å–∞–º</h4>
    <div class="flights-stats-grid">
        <div class="stat-item">
            <span class="stat-number">{{ flights_stats['flights_created'] }}</span>
            <span class="stat-label">–°–æ–∑–¥–∞–Ω–æ —Ä–µ–π—Å–æ–≤</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ flights_stats['total_seats'] }}</span>
            <span class="stat-label">–í—Å–µ–≥–æ –º–µ—Å—Ç</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ flights_stats['potential_revenue']|int }} ‚ÇΩ</span>
            <span class="stat-label">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞</span>
        </div>
    </div>
</div>
{% endif %}
    <div class="report-summary">
        <h3>–°–≤–æ–¥–∫–∞ –∑–∞ {{ report_date }}</h3>
        
        <div class="summary-cards">
            <div class="summary-card sales">
                <div class="card-icon">üí∞</div>
                <div class="card-content">
                    <div class="card-value">{{ report['total_sales'] }} ‚ÇΩ</div>
                    <div class="card-label">–û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</div>
                    <div class="card-subtext">{{ report['sales_count'] }} –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
            </div>
            
            <div class="summary-card returns">
                <div class="card-icon">‚Ü©Ô∏è</div>
                <div class="card-content">
                    <div class="card-value">{{ report['total_returns'] }} ‚ÇΩ</div>
                    <div class="card-label">–°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</div>
                    <div class="card-subtext">{{ report['returns_count'] }} –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
            </div>
            
            <div class="summary-card total">
                <div class="card-icon">üìä</div>
                <div class="card-content">
                    {% set net_amount = report['total_sales'] - report['total_returns'] %}
                    <div class="card-value {{ 'positive' if net_amount >= 0 else 'negative' }}">
                        {{ net_amount }} ‚ÇΩ
                    </div>
                    <div class="card-label">–ò—Ç–æ–≥–æ–≤–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                    <div class="card-subtext">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂ -->
    <div class="report-details">
        <div class="sales-details">
            <h4>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂</h4>
            
            {% if sales_details %}
            <div class="details-table">
                <table>
                    <thead>
                        <tr>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–ë–∏–ª–µ—Ç</th>
                            <th>–ü–∞—Å—Å–∞–∂–∏—Ä</th>
                            <th>–†–µ–π—Å</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–û–ø–ª–∞—Ç–∞</th>
                            <th>–ö–∞—Å—Å–∏—Ä</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for sale in sales_details %}
                        <tr>
                            <td>{{ sale['sale_date'][11:16] }}</td>
                            <td>‚Ññ{{ sale['ticket_id'] }}</td>
                            <td>{{ sale['passenger_name'] }}</td>
                            <td>{{ sale['flight_number'] }}</td>
                            <td>{{ sale['amount'] }} ‚ÇΩ</td>
                            <td>{{ '–ù–∞–ª' if sale['payment_method'] == 'cash' else '–ö–∞—Ä—Ç–∞' if sale['payment_method'] == 'card' else '–ü–µ—Ä–µ–≤–æ–¥' }}</td>
                            <td>{{ sale['cashier_phone'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="no-data">–ü—Ä–æ–¥–∞–∂ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å –Ω–µ—Ç</p>
            {% endif %}
        </div>
        
        <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ -->
        <div class="returns-details">
            <h4>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</h4>
            
            {% if returns_details %}
            <div class="details-table">
                <table>
                    <thead>
                        <tr>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–ë–∏–ª–µ—Ç</th>
                            <th>–ü–∞—Å—Å–∞–∂–∏—Ä</th>
                            <th>–†–µ–π—Å</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                            <th>–ö–∞—Å—Å–∏—Ä</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ret in returns_details %}
                        <tr>
                            <td>{{ ret['return_date'][11:16] }}</td>
                            <td>‚Ññ{{ ret['ticket_id'] }}</td>
                            <td>{{ ret['passenger_name'] }}</td>
                            <td>{{ ret['flight_number'] }}</td>
                            <td>{{ ret['ticket_price'] }} ‚ÇΩ</td>
                            <td>
                                {% if ret['explanation'] %}
                                {{ ret['explanation'][:20] }}...
                                {% else %}
                                {{ ret['reason'] }}
                                {% endif %}
                            </td>
                            <td>{{ ret['cashier_phone'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="no-data">–í–æ–∑–≤—Ä–∞—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å –Ω–µ—Ç</p>
            {% endif %}
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—á–∞—Ç–∏ -->
    <div class="report-actions">
        <button class="btn print-btn" onclick="window.print()">üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –æ—Ç—á–µ—Ç</button>
    </div>
</div>

<style>
@media print {
    .header, .back-btn, .report-form, .report-actions {
        display: none !important;
    }
    
    .dashboard {
        padding: 0 !important;
    }
}
</style>
{% endblock %}