{% extends "base.html" %}

{% block title %}{{ 'Редактирование' if action == 'edit' else 'Добавление' }} рейса{% endblock %}

{% block content %}
<div class="dashboard admin-dashboard">
    <div class="admin-header-with-actions">
        <h2>{{ '✏️ Редактирование рейса' if action == 'edit' else '➕ Добавление рейса' }}</h2>
        <div class="header-actions">
            <a href="/admin/flights" class="btn back-btn">← Назад к списку</a>
        </div>
    </div>
    
    <div class="edit-form-container">
        <form method="POST" class="edit-form">
            <div class="form-section">
                <h3>Основная информация</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="flight_number">Номер рейса:*</label>
                        <input type="text" id="flight_number" name="flight_number" 
                               value="{{ flight.flight_number if flight else '' }}"
                               placeholder="SU-100" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="price">Цена билета (руб.):*</label>
                        <input type="number" id="price" name="price" 
                               value="{{ flight.price if flight else '5000' }}"
                               min="1000" max="100000" step="100" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="departure_city">Город отправления:*</label>
                        <input type="text" id="departure_city" name="departure_city" 
                               value="{{ flight.departure_city if flight else 'Москва' }}"
                               placeholder="Москва" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="arrival_city">Город прибытия:*</label>
                        <input type="text" id="arrival_city" name="arrival_city" 
                               value="{{ flight.arrival_city if flight else 'Санкт-Петербург' }}"
                               placeholder="Санкт-Петербург" required>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Время вылета и прилета</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="departure_time">Вылет:*</label>
                        <input type="datetime-local" id="departure_time" name="departure_time" 
                               value="{{ flight.departure_time[:16] if flight and flight.departure_time else '' }}"
                               required>
                    </div>
                    
                    <div class="form-group">
                        <label for="arrival_time">Прилет:*</label>
                        <input type="datetime-local" id="arrival_time" name="arrival_time" 
                               value="{{ flight.arrival_time[:16] if flight and flight.arrival_time else '' }}"
                               required>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Информация о самолете</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="airplane">Тип самолета:</label>
                        <input type="text" id="airplane" name="airplane" 
                               value="{{ flight.airplane if flight else 'Airbus A320' }}"
                               placeholder="Airbus A320">
                    </div>
                    
                    <div class="form-group">
                        <label for="seats_available">Количество мест:*</label>
                        <input type="number" id="seats_available" name="seats_available" 
                               value="{{ flight.seats_available if flight else '180' }}"
                               min="1" max="1000" required>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Назначение и статус</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cashier_id">Кассир (ID):</label>
                        <input type="text" id="cashier_id" name="cashier_id" 
                               value="{{ flight.created_by if flight else '' }}"
                               placeholder="ID кассира (необязательно)"
                               min="1">
                        <small>Оставьте пустым, если рейс системный</small>
                    </div>
                    
                    {% if action == 'edit' %}
                    <div class="form-group">
                        <label for="status">Статус:</label>
                        <select id="status" name="status" class="form-control">
                            <option value="active" {{ 'selected' if flight.status == 'active' else '' }}>Активный</option>
                            <option value="cancelled" {{ 'selected' if flight.status == 'cancelled' else '' }}>Отменен</option>
                            <option value="completed" {{ 'selected' if flight.status == 'completed' else '' }}>Завершен</option>
                        </select>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-buttons">
                <button type="submit" class="btn save-btn">
                    {{ 'Сохранить изменения' if action == 'edit' else 'Добавить рейс' }}
                </button>
                <button type="reset" class="btn reset-btn">Сбросить</button>
                <a href="/admin/flights" class="btn cancel-btn">Отмена</a>
            </div>
        </form>
    </div>
</div>

<script>
// Устанавливаем минимальную дату - сегодня
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().slice(0, 16);
    const departureInput = document.getElementById('departure_time');
    const arrivalInput = document.getElementById('arrival_time');
    
    if (!departureInput.value) {
        departureInput.value = today;
        
        const arrivalTime = new Date(today);
        arrivalTime.setHours(arrivalTime.getHours() + 2);
        arrivalInput.value = arrivalTime.toISOString().slice(0, 16);
    }
    
    // Устанавливаем минимальные значения
    departureInput.min = today;
    arrivalInput.min = today;
});
</script>
{% endblock %}