{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏{% endblock %}

{% block content %}
<div class="dashboard admin-dashboard">
    <div class="admin-header-with-actions">
        <div>
            <h2>‚úàÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏</h2>
            <p>–í—Å–µ–≥–æ —Ä–µ–π—Å–æ–≤: {{ flights|length }}</p>
        </div>
        <div class="header-actions">
            <a href="/admin/flights/add" class="btn create-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å</a>
            <a href="/admin" class="btn back-btn">‚Üê –ù–∞–∑–∞–¥</a>
        </div>
    </div>
    
    <!-- –ü–û–ò–°–ö –†–ï–ô–°–û–í -->
    <div class="search-section">
        <h3>üîç –ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤</h3>
        <form method="POST" class="search-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="flight_number">–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞:</label>
                    <input type="text" id="flight_number" name="flight_number" 
                           placeholder="SU-100">
                </div>
                <div class="form-group">
                    <label for="departure_city">–û—Ç–∫—É–¥–∞:</label>
                    <input type="text" id="departure_city" name="departure_city" 
                           placeholder="–ú–æ—Å–∫–≤–∞">
                </div>
                <div class="form-group">
                    <label for="arrival_city">–ö—É–¥–∞:</label>
                    <input type="text" id="arrival_city" name="arrival_city" 
                           placeholder="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">
                </div>
                <div class="form-group">
                    <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                    <select id="status" name="status">
                        <option value="">–í—Å–µ</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</option>
                        <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                    </select>
                </div>
            </div>
            <div class="form-buttons">
                <button type="submit" class="btn search-btn">–ù–∞–π—Ç–∏</button>
                <button type="reset" class="btn reset-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <a href="/admin/flights" class="btn show-all-btn">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</a>
            </div>
        </form>
    </div>
    
    <!-- –°–ü–ò–°–û–ö –†–ï–ô–°–û–í -->
    <div class="flights-table-section">
        <h3>üìã –°–ø–∏—Å–æ–∫ —Ä–µ–π—Å–æ–≤</h3>
        
        {% if flights %}
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–†–µ–π—Å</th>
                        <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                        <th>–í—ã–ª–µ—Ç</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–ú–µ—Å—Ç–∞</th>
                        <th>–°–∞–º–æ–ª–µ—Ç</th>
                        <th>–ö–∞—Å—Å–∏—Ä</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for flight in flights %}
                    <tr>
                        <td>{{ flight.id }}</td>
                        <td>
                            <strong>{{ flight.flight_number }}</strong>
                        </td>
                        <td>
                            {{ flight.departure_city }} ‚Üí {{ flight.arrival_city }}
                        </td>
                        <td>{{ flight.departure_time[:16] }}</td>
                        <td>{{ flight.price }} ‚ÇΩ</td>
                        <td>
                            <span class="{{ 'seats-available' if flight.seats_available > 0 else 'seats-full' }}">
                                {{ flight.seats_available }}
                            </span>
                        </td>
                        <td>{{ flight.airplane or '-' }}</td>
                        <td>{{ flight.cashier_phone or '-' }}</td>
                        <td>
                            <span class="status-badge status-{{ flight.status }}">
                                {% if flight.status == 'active' %}‚úÖ –ê–∫—Ç–∏–≤–µ–Ω
                                {% elif flight.status == 'cancelled' %}‚ùå –û—Ç–º–µ–Ω–µ–Ω
                                {% elif flight.status == 'completed' %}üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω
                                {% else %}{{ flight.status }}{% endif %}
                            </span>
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <a href="/admin/flights/edit/{{ flight.id }}" 
                                   class="btn-action edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    ‚úèÔ∏è
                                </a>
                                {% if flight.status == 'active' %}
                                <a href="/admin/flights/delete/{{ flight.id }}" 
                                   class="btn-action delete" 
                                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ä–µ–π—Å {{ flight.flight_number }}?')"
                                   title="–£–¥–∞–ª–∏—Ç—å">
                                    üóëÔ∏è
                                </a>
                                {% endif %}
                                <a href="/cashier/sell/{{ flight.id }}" 
                                   class="btn-action sell" title="–ü—Ä–æ–¥–∞—Ç—å –±–∏–ª–µ—Ç">
                                    üé´
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="no-data">
            {% if search_performed %}
            <p>–†–µ–π—Å—ã –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            {% else %}
            <p>–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–π—Å–æ–≤</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
    <div class="stats-section">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats-cards">
            {% set active_flights = flights|selectattr('status', 'equalto', 'active')|list %}
            {% set cancelled_flights = flights|selectattr('status', 'equalto', 'cancelled')|list %}
            {% set total_seats = flights|sum(attribute='seats_available') %}
            {% set avg_price = flights|sum(attribute='price') / flights|length if flights|length > 0 else 0 %}
            
            <div class="stat-card">
                <div class="stat-value">{{ flights|length }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ä–µ–π—Å–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ active_flights|length }}</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ cancelled_flights|length }}</div>
                <div class="stat-label">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total_seats }}</div>
                <div class="stat-label">–°–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ avg_price|int }} ‚ÇΩ</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
            </div>
        </div>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
.admin-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.admin-table th {
    background: #1976d2;
    color: white;
    padding: 15px;
    text-align: left;
    font-weight: 500;
    border-bottom: 2px solid #0d47a1;
}

.admin-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e0e0e0;
}

.admin-table tr:hover {
    background: #f5f5f5;
}

/* –°—Ç–∞—Ç—É—Å—ã */
.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.status-active {
    background: #e8f5e9;
    color: #2e7d32;
}

.status-cancelled {
    background: #ffebee;
    color: #c62828;
}

.status-completed {
    background: #f3e5f5;
    color: #7b1fa2;
}

/* –ú–µ—Å—Ç–∞ */
.seats-available {
    color: #2e7d32;
    font-weight: bold;
}

.seats-full {
    color: #c62828;
    font-weight: bold;
}

/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.actions-cell {
    min-width: 120px;
}

.action-buttons {
    display: flex;
    gap: 5px;
}

.btn-action {
    padding: 5px 10px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.3s;
}

.btn-action.edit {
    background: #bbdefb;
    color: #0d47a1;
}

.btn-action.edit:hover {
    background: #90caf9;
}

.btn-action.delete {
    background: #ffcdd2;
    color: #b71c1c;
}

.btn-action.delete:hover {
    background: #ef9a9a;
}

.btn-action.sell {
    background: #c8e6c9;
    color: #1b5e20;
}

.btn-action.sell:hover {
    background: #a5d6a7;
}

/* –ü–æ–∏—Å–∫ */
.search-section {
    background: #f8fbff;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 1px solid #bbdefb;
}

.search-form .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.form-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1200px) {
    .table-container {
        overflow-x: auto;
    }
    
    .admin-table {
        font-size: 14px;
    }
    
    .admin-table th,
    .admin-table td {
        padding: 10px;
    }
}
</style>
{% endblock %}